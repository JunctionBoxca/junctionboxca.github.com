<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7" manifest="default.appcache?v=1"><![endif]-->
<!--[if lt IE 7 ]><html class="no-js ie6" lang="en"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7" lang="en"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8" lang="en"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" manifest="default.appcache?v=1" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">

  <title>Subversive Lyrics with Subversion - JunctionBox.ca</title>
  <meta name="author" content="Nathan Fisher">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1">

  

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <!--<script src="/javascripts/octopress.js" type="text/javascript"></script>-->
  <script src="javascripts/libs/modernizr-1.7.min.js"></script>
  <script src="javascripts/libs/ios-viewport-scaling-bug-fix.js"></script>
  
    <script src="http://www.google-analytics.com/ga.js" type="text/javascript"></script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '#{page.google_analytics_tracking_id}']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();
</script>

  
  <link href="/atom.xml" rel="alternate" title="JunctionBox.ca" type="application/atom+xml"/>
</head>

<body  >
  <header><div><h1><a href="/">JunctionBox.ca</a></h1>
</div></header>
  <nav><div><div>
  <a href="/atom.xml">Subscribe</a>
  <form action="http://google.com/search" method="get">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
    <input type="hidden" name="q" value="site:junctionbox.ca" />
  </form>
</div>
<ul>
  <li><a href="/?s=nav">Home</a></li>
  <li><a href="/nathan-fisher.html?s=nav">About</a></li>
  <li><a href="/archive/?s=nav">Archive</a></li>
</ul>
</div></nav>
  <div>
    <div>
      <div id="articles"><article>
  <header>
  <h1><a href="/2008/06/26/subversive-lyrics-with-subversion/">Subversive Lyrics with Subversion</a></h1>
  <p>
    
      <span class="byline author vcard">By <span class="fn">Nathan Fisher</span></span>
    
    
      <time datetime="Thu Jun 26 00:00:00 -0700 2008" pubdate>June 26<span>th</span>, 2008</time>
    
    
  </p>
</header>

<div class="entry">The plan for today is to build an automated test environment (static websites only) that updates with each commit. Now I should forewarn you if you play this article backwards the devil will steal your dog, and wife, and leave you with nothing more than a crappy country song. Should that or anything else bad happen be an adult and take responsibility for your own actions, aka I&#8217;m not liable.  Also if you don&#8217;t know what subversion is this article is not a good place to start.\nh3. Ingredients

* Wildcard DNS
* Apache 2.2
* Subversion 1.4.x (SVN)
* Your favourite scripting language
* Back-ups, back-ups, back-ups!!!!!
* Couple of hours

Okay so how is all of this going to look? Well lets say you have a client named Example and their website is located at example.com.  The goal is to achieve a test site located at http://example.com.projects.myhost.ca/, it&#8217;s a doozy to type, but it&#8217;ll create consistency. Besides the amount of time spent typing will be more than offset by the time it saves you once configured properly.

h3. Initial Imports Insulate Against Insolence

Okay so lets say you&#8217;ve used svnadmin and created a webdav accessible repository at http://myhost.ca/svn/example.com/, how should the initial import look?

* branches
* tags
* trunk
** site
** src

As you&#8217;ll note it&#8217;s a pretty vanilla setup for subversion.  So moving forward we&#8217;ll assume that trunk/site contains the latest and greatest of your clients website and trunk src is a dumping ground for your Illustrator, Photoshop, Actionscript and FLA&#8217;s, etc.

h3. We Hosts Da Vhosts

So what&#8217;s next? Lets get ready to rumble cuz we&#8217;re going to create our vhost configuration. Pick your poison, but you can either append the following setup to your httpd.conf or add a new file named vhosts.conf in your conf.d folder.

<pre>
LogFormat "%V %h %l %u %t \"%r\" %s %b" vcommon

<Directory /var/www/vhosts/project>
# adjust override as you see fit
AllowOverride All
</Directory>

<virtualhost *:80>
ServerName *.projects.myhost.ca

VirtualDocumentRoot /var/www/vhosts/projects/%-4+

ErrorLog logs/projects.myhost.ca-error_log
CustomLog logs/projects.myhost.ca-access_log vcommon
</virtualhost>
</pre>

h3. Sweet Script O&#8217;Mine

Where do we go now&#8230; GNR flashback&#8230; I think not! So we&#8217;ve got a repository and vhost now what? You&#8217;ve got 2 options here;
write a script that updates an existing checkout.
write a script that creates a checkout if it does not exist or updates if it does.
Option 1 is what I&#8217;ve gone with as I&#8217;ve placed the checkout in a script for the creation of my repository. The benefit to Option 2 is that it ensures you&#8217;re checkout environment will have the right permissions for svn updates.

My script looks a little like the following;

<pre>
#!/usr/bin/ruby -w
#
# update.rb: Takes a repository URI as a single argument and uses the 
#    last directory in the URI as part of the update path.
#

if ARGV.length != 1
 puts "You must specify a repository!"
end

# this folder must be owned by your webservers uid if you go with option 2
PROJECTS_PATH='/var/www/vhosts/projects/'

begin
 site_name = ARGV[0].split( /\// );
 site_name = site_name[site_name.length - 1]
 
 `svn update #{PROJECTS_PATH + site_name}`
rescue
 # pick a error notification method log it, email it wuteva you want
end
</pre>

Now add this to the end of your post-commit hook as follows;

@/somepath/update.rb &#8220;$REPOS&#8221;@

Everytime you commit, it will automatically update a test copy of the site located at;

@http://example.com.projects.myhost.ca/@

h3. Conclusion

This is a simple way to give the whole family access to test websites without the clutter and extra time of using FTP.

</div>


  
    <div id="disqus_thread"><script type="text/javascript">
  var disqus_url = "http://junctionbox.ca/2008/06/26/subversive-lyrics-with-subversion/";
</script>
<noscript>
  <a href="http://junctionboxca.disqus.com/?url=ref">View the discussion thread</a>
</noscript>
<script type="text/javascript" src="http://disqus.com/forums/junctionboxca/embed.js"></script>
</div>
  
</article>
</div>
      
        <aside><section>
<img src="http://www.myopenid.com/image?id=142724" alt="Nathan Fisher"/>
<h2>JunctionBox.ca</h2> 
<h3>Nathan Fisher - DevOp</h3>
 
<p class="quiet">DevOps is a common sense approach to software release cycles. It's an accumulation of best practices and the agreement that software has no business value until it's in the hands of its intended user. The name is derived from the curious union of development and operations and is most commonly described as a "bridge of communication" between developers and operations. Criticise if you will, but when people have their head in code they sometimes don't take into account the bigger picture. Ultimately that's what it's all about. Common tools of the trade include: virtualization, configuration management, CI, and automation of as much as reasonable. If you're interested in knowing more take a look at Jez Humbles book <a href="http://continuousdelivery.com/">Continuous Delivery</a>.</p>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/05/28/branching-by-abstraction-101/">Branching by Abstraction 101</a>
        <time>May 28, 2011</time>
      </li>
    
      <li class="post">
        <a href="/2011/02/10/bootstrapping-windows/">Bootstrapping Windows</a>
        <time>February 10, 2011</time>
      </li>
    
      <li class="post">
        <a href="/2010/10/05/initial-configuration-of-puppetd-on-os-x/">Initial Configuration of Puppetd on OS X</a>
        <time>October 05, 2010</time>
      </li>
    
      <li class="post">
        <a href="/2010/08/01/dance-and-pivot-sql-style/">Dance and Pivot SQL Style</a>
        <time>August 01, 2010</time>
      </li>
    
      <li class="post">
        <a href="/2010/04/17/simplified-tdd-with-sinatra-autotest/">Simplified TDD with Sinatra autotest</a>
        <time>April 17, 2010</time>
      </li>
    
      <li class="post">
        <a href="/2010/03/24/dom-a-regato--my-tests-are-auto/">Dom A Regato, My Tests Are Auto</a>
        <time>March 24, 2010</time>
      </li>
    
      <li class="post">
        <a href="/2010/02/23/fresh-book-it/">Fresh Book It</a>
        <time>February 23, 2010</time>
      </li>
    
      <li class="post">
        <a href="/2009/12/12/approaching-bliss--tdd%2Bphp%2Bmvc/">Approaching bliss; TDD+PHP+MVC</a>
        <time>December 12, 2009</time>
      </li>
    
      <li class="post">
        <a href="/2009/11/03/kick-dependence--here-s-an-injection/">Kick dependence, here's an injection</a>
        <time>November 03, 2009</time>
      </li>
    
      <li class="post">
        <a href="/2009/06/17/tripping-over-rubies-while-camping/">Tripping over Rubies while Camping</a>
        <time>June 17, 2009</time>
      </li>
    
  </ul>
	<p><a href="/archive/?s=sidebar">More Articles</a></p>
  </section>


  <section><h1>Latest Tweets</h1>
<ul id="tweets">
  Status updating...
</ul>
<p>Follow <a href="http://twitter.com/junctionboxca">@junctionboxca</a></p>

  <script>
    var twitter_user = "junctionboxca";
    var show_replies = false;
    var tweet_count = 3;
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"></script>

</section>



</aside>
      
    </div>
  </div>
  <footer><div><p>
	<a href="/?s=footer">Home</a> |
	<a href="/nathan-fisher.html?s=footer">About</a> |
	<a href="/archive/?s=footer">Archive</a> |
  Copyright &copy; 2011 - Nathan Fisher -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</div></footer>
  <!--[if (lt IE 9) & (!IEMobile)]>
  <script src="javascripts/libs/DOMAssistantCompressed-2.8.js"></script>
  <script src="javascripts/libs/selectivizr-1.0.1.js"></script>
  <script src="javascripts/libs/respond.min.js"></script>
  <![endif]-->
</body>
</html>
